{% extends "main/static/base.html" %}
{% load static %}
{% block content %}
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

<!-- Форма для включения/выключения уведомлений в Telegram -->
<div class="container my-4">
    
<!-- Форма для включения/выключения уведомлений в Telegram -->
     {% include "users/module/telegram_setings.html" %}

<!-- Форма для управления отслеживыаемых слов пользователем -->
     {% include "users/module/trecking_word_setings.html" %}
     
</div>



<script>
    var csrftoken = $("[name=csrfmiddlewaretoken]").val();
    $("#addWordForm").submit(function(e) {
        e.preventDefault();
        $.post("{% url 'users:add_word_api' %}", $(this).serialize()).done(function(data) {
            if (data.status == 'success') {
                $("#wordList").append('<li class="list-group-item d-flex justify-content-between align-items-center" data-id="' 
                + data.word_id + '">' + data.word_text + 
                '<span class="badge badge-primary badge-pill">'+ data.count + '</span>' +
                ' <button class="btn btn-danger btn-sm deleteWord">Удалить</button></li>');
            } else {
                alert(data.errors.keyword);
            }
        });
    });

    $("#wordList").on("click", ".deleteWord", function() {
        var li = $(this).closest('li');
        var wordId = li.attr('data-id');
        $.ajax({
            url: "{% url 'users:delete_word_api' '0' %}".replace('0', wordId),
            type: 'DELETE',
            beforeSend: function(xhr) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            },
            success: function(data) {
                if (data.status == 'success') {
                    li.remove();
                } else {
                    alert(data.message);
                }
            }
        });
    });
</script>
<script>
    $(document).ready(function() {
        $('.cardToggle').on('click', function() {
            const cardBody = $(this).next('.card-body');
            cardBody.slideToggle('slow');
    

        });
    });
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>   
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

{% endblock %}
